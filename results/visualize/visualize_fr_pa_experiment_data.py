import matplotlib.pyplot as plt
import numpy as np

# Configurations
configs = ["PA2", "PA3", "PA4", "PA5", "PA6", "PA7"]

# Data extracted from pa_experiment_data
pa_experiment_metrics = {
    "KneeSlice": {
        "FSIM": ([0.453, 0.469, 0.480, 0.497, 0.521, 0.547], [0.045, 0.049, 0.050, 0.052, 0.051, 0.050]),
        # "UQI": ([-1376829301390.813, -100786976869.203, 337305466805.444, 0.318, 0.370, 5874986680749.521],
        #          [6001459787269.535, 439320246999.045, 1470280442907.306, 0.161, 0.163, 25608473236032.590]),
        "PSNR": ([22.989, 23.848, 24.445, 25.042, 25.847, 26.462], [2.691, 2.372, 2.099, 1.880, 1.520, 1.373]),
        "SSIM": ([0.122, 0.156, 0.183, 0.228, 0.303, 0.378], [0.148, 0.158, 0.148, 0.134, 0.101, 0.089]),
        "VIF": ([0.044, 0.056, 0.065, 0.083, 0.112, 0.151], [0.038, 0.044, 0.048, 0.051, 0.054, 0.056]),
        "S3IM": ([0.161, 0.174, 0.185, 0.216, 0.272, 0.330], [0.059, 0.043, 0.039, 0.046, 0.059, 0.085])
    },
    "Phantoms": {
        "FSIM": ([0.353, 0.393, 0.431, 0.485, 0.559, 0.667], [0.037, 0.044, 0.049, 0.053, 0.055, 0.068]),
        # "UQI": ([0.138, 0.274, 0.494, 0.222, 0.232, -1173115892882.330], [0.213, 0.810, 1.435, 0.137, 0.569, 9602367425534.951]),
        "PSNR": ([23.472, 24.845, 26.354, 28.024, 30.515, 35.267], [3.601, 3.586, 3.345, 3.151, 3.109, 3.600]),
        "SSIM": ([0.161, 0.207, 0.260, 0.332, 0.468, 0.673], [0.091, 0.126, 0.141, 0.156, 0.179, 0.191]),
        "VIF": ([0.097, 0.133, 0.168, 0.219, 0.296, 0.446], [0.033, 0.044, 0.051, 0.062, 0.072, 0.116]),
        "S3IM": ([0.175, 0.206, 0.243, 0.295, 0.406, 0.585], [0.040, 0.055, 0.067, 0.079, 0.101, 0.146])
    },
    "SmallAnimal": {
        "FSIM": ([0.238, 0.263, 0.287, 0.324, 0.404, 0.543], [0.008, 0.014, 0.020, 0.029, 0.046, 0.068]),
        # "UQI": ([0.136, 17320123747.164, 0.086, 182446617365.085, -0.172, -13455951357.206],
        #          [0.368, 86600618736.186, 0.080, 781047217707.177, 1.809, 65920429657.337]),
        "PSNR": ([18.112, 21.325, 23.135, 25.033, 28.777, 33.541], [2.232, 1.877, 1.743, 1.851, 1.629, 1.391]),
        "SSIM": ([0.095, 0.147, 0.189, 0.245, 0.392, 0.649], [0.022, 0.033, 0.042, 0.060, 0.088, 0.086]),
        "VIF": ([0.051, 0.079, 0.110, 0.161, 0.262, 0.414], [0.006, 0.015, 0.022, 0.028, 0.042, 0.061]),
        "S3IM": ([0.112, 0.152, 0.190, 0.235, 0.328, 0.536], [0.012, 0.022, 0.030, 0.038, 0.056, 0.075])
    },
    "Transducers": {
        "FSIM": ([0.353, 0.373, 0.389, 0.417, 0.469, 0.520], [0.098, 0.093, 0.090, 0.083, 0.074, 0.024]),
        # "UQI": ([0.139, 0.007, -0.119, -0.089, 1781292197.258, -2647672912710755.500], [0.170, 0.066, 0.316, 0.269, 3085288588.555, 3708645661483450.500]),
        "PSNR": ([32.328, 34.846, 35.218, 35.452, 37.263, 30.644], [12.556, 12.256, 12.245, 12.254, 11.993, 3.751]),
        "SSIM": ([0.355, 0.406, 0.406, 0.404, 0.454, 0.340], [0.359, 0.338, 0.337, 0.337, 0.312, 0.108]),
        "VIF": ([0.275, 0.303, 0.361, 0.461, 0.588, 0.663], [0.074, 0.065, 0.076, 0.081, 0.085, 0.019]),
        "S3IM": ([0.122, 0.145, 0.148, 0.153, 0.191, 0.227], [0.003, 0.005, 0.005, 0.005, 0.010, 0.008])
    }
}

def plot_metrics(title, metrics):
    x = np.arange(len(configs))
    fig, (ax_top, ax_bottom) = plt.subplots(2, 1, sharex=True, figsize=(12, 10), gridspec_kw={'height_ratios': [1, 1]})
    plt.rcParams.update({'font.size': 14})
    
    for metric, (values, std) in metrics.items():
        values, std = np.array(values), np.array(std)
        if metric == "PSNR":
            ax_top.plot(x, values, label=metric, linestyle="--", marker="o", color="tab:blue")
            ax_top.fill_between(x, values - std, values + std, color="tab:blue", alpha=0.2)
        else:
            ax_bottom.plot(x, values, label=metric, linestyle="-", marker="o")
            ax_bottom.fill_between(x, values - std, values + std, alpha=0.2)
    
    ax_top.spines['bottom'].set_visible(False)
    ax_bottom.spines['top'].set_visible(False)
    ax_top.set_ylabel("PSNR (dB)", color="tab:blue", fontsize=18)
    ax_bottom.set_ylabel("Metric Value", fontsize=18)
    ax_bottom.set_xticks(x)
    ax_bottom.set_xticklabels(configs, rotation=45, fontsize=16)
    ax_top.legend(loc="upper right", fontsize=16)
    ax_bottom.legend(loc="upper left", fontsize=16)
    plt.suptitle(f"{title} Dataset", fontsize=20)
    plt.show()

# Generate plots
for dataset, metrics in pa_experiment_metrics.items():
    plot_metrics(dataset, metrics)
